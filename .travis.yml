language: cpp
compiler:
- gcc
os:
- linux
matrix:
  include:
  - os: linux
    addons:
      apt:
        sources:
        - ubuntu-toolchain-r-test
        packages:
        - g++-5
        - cmake
        - zip
        - unzip
        - gcc-5-multilib
        - g++-5-multilib
    env:
    - MATRIX_EVAL="CC=gcc-5 && CXX=g++-5"
before_install:
- eval "${MATRIX_EVAL}"
install:
- wget https://github.com/gabime/spdlog/archive/v0.10.0.zip
- wget https://dev.mysql.com/get/Downloads/Connector-C/mysql-connector-c-6.1.11-linux-glibc2.12-x86_64.tar.gz
- unzip -qq v0.10.0.zip
- mv spdlog-0.10.0/include/spdlog include
- mkdir mysql
- tar -zxf mysql-connector-c-6.1.11-linux-glibc2.12-x86_64.tar.gz -C mysql --strip-components=1
script:
- sed -i "s|^SET(MYSQL64_HOME.*|SET(MYSQL64_HOME \"$PWD\/mysql\")|" build/CMakeLists.txt
- cd build
- cmake . -DCMAKE_C_FLAGS=-m64 -DCMAKE_CXX_FLAGS=-m64
- make
- mv libr3_extension_x64.so r3_extension_x64.so
- if [ ! -z "$TRAVIS_TAG" ]; then zip "R3-Extension-$TRAVIS_TAG-Linux.zip" r3_extension_x64.so;
  fi
deploy:
  provider: releases
  api_key:
    secure: VxwwaSWdqbZoTfuUIAmhGUuG9uDU4S43/Bu0L788Ui3sy6/MfV075bNhEqJTA09eZo404A/1SyI7397YicbxVAEtKJlYu0H3wnfh1tw+aEqVAsnyOYbRrgSAkit9RCYPBN2PKglOUOCrvMvUjuocRU4Lfi2e9TPCNhldC95tQmTggepn5eBcVOFw0vTZ3tNr3zOdu4cldfX7XrZ1iqpo0ZLts2tVEmxqcwiizFGH0jn5T+gLDme5sf9EjN8ZkhUA0y+XXYa2Jigo0gELeA/zSUXTVE+IPZGKxhpZeWANru/a4F8XovP1q/jy/XU6gUq+jbqZFQ7OfmwKTxJI8VtzBAlCgecP5qu2/b9pfAJHJKM38FLdGOUKK0vXu8dbS4vAbgeHXl6GsDc+w/8WBLAWTwniSlGEEY7N7G9b35iT7jtNcRGSWQlLpLlDdJtYe9XN1s5GuciNX4uZgaj7hrRl3edjjPbKYlhz+quwMlv1I0u5NfYnizuWyQA3PASyMEe3jVc+9COuSnKNgURzLVGC007EIQdG7AM61n6wEuqRIgv4cOjDR8t96ZZLcq9he7ljW6CtvXsEQ/FPlY093mN+/OpBoJuhTXM/cJmlPMZMzfxD4yYl80a+2cdZZG8QOMXAAr56/cCAseq47ckVIMKg7tyw17+jU07Fkp1r+VYVPbE=
  file: "R3-Extension-$TRAVIS_TAG-Linux.zip"
  skip_cleanup: true
  on:
    repo: Raptoer/R3-Extension
    branch: data-refactor
